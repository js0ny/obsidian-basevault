/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var je=Object.create;var Y=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ye=Object.getPrototypeOf,qe=Object.prototype.hasOwnProperty;var Qe=(n,t)=>{for(var e in t)Y(n,e,{get:t[e],enumerable:!0})},fe=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of $e(t))!qe.call(n,i)&&i!==e&&Y(n,i,{get:()=>t[i],enumerable:!(r=Ue(t,i))||r.enumerable});return n};var ze=(n,t,e)=>(e=n!=null?je(Ye(n)):{},fe(t||!n||!n.__esModule?Y(e,"default",{value:n,enumerable:!0}):e,n)),Ge=n=>fe(Y({},"__esModule",{value:!0}),n);var mt={};Qe(mt,{default:()=>te});module.exports=Ge(mt);var c=require("obsidian");var pe=/^(.|[a-z]+|f[1-9]|f1[0-2])$/i,de={" ":"SPC",enter:"ENT",tab:"TAB",backspace:"BSP",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right"},he={enter:"\u21B5",backspace:"\u232B",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192"};function V(n){return n.length==1&&n!=" "}var R=class n{constructor(t,e={}){var r,i,a,o;this.key=t,this.ctrl=(r=e.ctrl)!=null?r:!1,this.shift=(i=e.shift)!=null?i:!1,this.alt=(a=e.alt)!=null?a:!1,this.meta=(o=e.meta)!=null?o:!1}static fromEvent(t){let e=t.key;e.length>1&&(e=e.toLowerCase());let r={ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey},i=new n(e,r);return V(e)&&(i.shift=!1),i}static compare(t,e){if(t.key!=e.key){let r=V(t.key),i=V(e.key);return!r&&i?-1:r&&!i?1:t.key.localeCompare(e.key)}return!t.ctrl&&e.ctrl?-1:t.ctrl&&!e.ctrl?1:!t.shift&&e.shift?-1:t.shift&&!e.shift?1:!t.alt&&e.alt?-1:t.alt&&!e.alt?1:!t.meta&&e.meta?-1:t.meta&&!e.meta?1:0}equals(t){return this.key==t.key&&this.ctrl==t.ctrl&&this.shift==t.shift&&this.alt==t.alt&&this.meta==t.meta}repr(t=!1){let e="";return this.ctrl&&(e+=t?"^":"C"),this.shift&&!V(this.key)&&(e+=t?"\u21E7":"S"),this.alt&&(e+=t?"\u2387":"A"),this.meta&&(e+=t?"\u229E":"M"),e&&!t&&(e+="-"),t&&this.key in he?e+=he[this.key]:this.key in de?e+=de[this.key]:!t&&this.key.length>1?e+=this.key.toUpperCase():e+=this.key,e}},L=class{constructor(t,e=null){this.command_id=t;this.description=e}},I=class{constructor(t,e=null){this.file_path=t;this.description=e}},T=class n{constructor(t=null){this.description=t,this.children=[]}isEmpty(){return this.children.length==0}setChild(t,e){for(let r=0;r<this.children.length;r++)if(this.children[r].key.equals(t)){let i=this.children[r].item;return this.children[r]={key:t,item:e},i}return this.children.push({key:t,item:e}),null}removeChild(t){for(let e=0;e<this.children.length;e++)if(this.children[e].key.equals(t))return this.children.splice(e,1)[0].item;return null}getChild(t){for(let e of this.children)if(e.key.equals(t))return e.item;return null}find(t,e=!1){let r=this,i;for(let a of t){if(!(r instanceof n))return e?null:r;if(i=r.getChild(a),!i)return null;r=i}return r}copy(){let t=new n(this.description);for(let e of this.children)t.children.push({...e});return t}walk(t){this._walk(t,[])}_walk(t,e){t(this,e);for(let r of this.children){let i=e.concat([r.key]);r.item instanceof n?r.item._walk(t,i):t(r.item,i)}}assignedCommands(){let t={};return this.walk((e,r)=>{var i,a;e instanceof L&&((a=t[i=e.command_id])!=null?a:t[i]=[]).push(r)}),t}};var k=require("obsidian");var P=require("obsidian");var v=require("@codemirror/state"),b=require("@codemirror/language"),Je=ze(require("@codemirror/view"),1),_=require("@codemirror/view"),N=require("@codemirror/search"),g=require("@codemirror/commands");function C(n,t){var e=t.ch,r=t.line+1;r<1&&(r=1,e=0),r>n.lines&&(r=n.lines,e=Number.MAX_VALUE);var i=n.line(r);return Math.min(i.from+Math.max(0,e),i.to)}function S(n,t){let e=n.lineAt(t);return{line:e.number-1,ch:t-e.from}}var M=class{constructor(t,e){this.line=t,this.ch=e}};function ye(n,t,e){if(n.addEventListener)n.addEventListener(t,e,!1);else{var r=n._handlers||(n._handlers={});r[t]=(r[t]||[]).concat(e)}}function ke(n,t,e){if(n.removeEventListener)n.removeEventListener(t,e,!1);else{var r=n._handlers,i=r&&r[t];if(i){var a=i.indexOf(e);a>-1&&(r[t]=i.slice(0,a).concat(i.slice(a+1)))}}}function we(n,t,...e){var r,i=(r=n._handlers)===null||r===void 0?void 0:r[t];if(i)for(var a=0;a<i.length;++a)i[a](...e)}function ge(n,...t){if(n)for(var e=0;e<n.length;++e)n[e](...t)}var ne;try{ne=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch(n){ne=/[\w]/}function j(n,t){var e=n.cm6;if(!e.state.readOnly){var r="input.type.compose";if(n.curOp&&(n.curOp.lastChange||(r="input.type.compose.start")),t.annotations)try{t.annotations.some(function(i){i.value=="input"&&(i.value=r)})}catch(i){console.error(i)}else t.userEvent=r;return e.dispatch(t)}}function ve(n,t){var e;n.curOp&&(n.curOp.$changeStart=void 0),(t?g.undo:g.redo)(n.cm6);let r=(e=n.curOp)===null||e===void 0?void 0:e.$changeStart;r!=null&&n.cm6.dispatch({selection:{anchor:r}})}var Xe={},d=class n{constructor(t){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=t,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(t,e,r){return et(this,t,e,r)}openNotification(t,e){return Ze(this,t,e)}on(t,e){ye(this,t,e)}off(t,e){ke(this,t,e)}signal(t,e,r){we(this,t,e,r)}indexFromPos(t){return C(this.cm6.state.doc,t)}posFromIndex(t){return S(this.cm6.state.doc,t)}foldCode(t){let e=this.cm6,r=e.state.selection.ranges,i=this.cm6.state.doc,a=C(i,t),o=v.EditorSelection.create([v.EditorSelection.range(a,a)],0).ranges;e.state.selection.ranges=o,(0,b.foldCode)(e),e.state.selection.ranges=r}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(t,e){typeof t=="object"&&(e=t.ch,t=t.line);var r=C(this.cm6.state.doc,{line:t,ch:e||0});this.cm6.dispatch({selection:{anchor:r}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(t){var e=this.cm6.state.selection.main,r=t=="head"||!t?e.head:t=="anchor"?e.anchor:t=="start"?e.from:t=="end"?e.to:null;if(r==null)throw new Error("Invalid cursor type");return this.posFromIndex(r)}listSelections(){var t=this.cm6.state.doc;return this.cm6.state.selection.ranges.map(e=>({anchor:S(t,e.anchor),head:S(t,e.head)}))}setSelections(t,e){var r=this.cm6.state.doc,i=t.map(a=>{var o=C(r,a.head),s=C(r,a.anchor);return o==s?v.EditorSelection.cursor(o,1):v.EditorSelection.range(s,o)});this.cm6.dispatch({selection:v.EditorSelection.create(i,e)})}setSelection(t,e,r){this.setSelections([{anchor:t,head:e}],0),r&&r.origin=="*mouse"&&this.onBeforeEndOperation()}getLine(t){var e=this.cm6.state.doc;return t<0||t>=e.lines?"":this.cm6.state.doc.line(t+1).text}getLineHandle(t){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{row:t,index:this.indexFromPos(new M(t,0))}}getLineNumber(t){var e=this.$lineHandleChanges;if(!e)return null;for(var r=t.index,i=0;i<e.length;i++)if(r=e[i].changes.mapPos(r,1,v.MapMode.TrackAfter),r==null)return null;var a=this.posFromIndex(r);return a.ch==0?a.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(t,e){var r=this.cm6.state.doc;return this.cm6.state.sliceDoc(C(r,t),C(r,e))}replaceRange(t,e,r,i){r||(r=e);var a=this.cm6.state.doc,o=C(a,e),s=C(a,r);j(this,{changes:{from:o,to:s,insert:t}})}replaceSelection(t){j(this,this.cm6.state.replaceSelection(t))}replaceSelections(t){var e=this.cm6.state.selection.ranges,r=e.map((i,a)=>({from:i.from,to:i.to,insert:t[a]||""}));j(this,{changes:r})}getSelection(){return this.getSelections().join(`
`)}getSelections(){var t=this.cm6;return t.state.selection.ranges.map(e=>t.state.sliceDoc(e.from,e.to))}somethingSelected(){return this.cm6.state.selection.ranges.some(t=>!t.empty)}getInputField(){return this.cm6.contentDOM}clipPos(t){var e=this.cm6.state.doc,r=t.ch,i=t.line+1;i<1&&(i=1,r=0),i>e.lines&&(i=e.lines,r=Number.MAX_VALUE);var a=e.line(i);return r=Math.min(Math.max(0,r),a.to-a.from),new M(i-1,r)}getValue(){return this.cm6.state.doc.toString()}setValue(t){var e=this.cm6;return e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t},selection:v.EditorSelection.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(t,e){var r=this.cm6.state,i=C(r.doc,t),a=(0,b.matchBrackets)(r,i+1,-1);return a&&a.end?{to:S(r.doc,a.end.from)}:(a=(0,b.matchBrackets)(r,i,1),a&&a.end?{to:S(r.doc,a.end.from)}:{to:void 0})}scanForBracket(t,e,r,i){return nt(this,t,e,r,i)}indentLine(t,e){e?this.indentMore():this.indentLess()}indentMore(){(0,g.indentMore)(this.cm6)}indentLess(){(0,g.indentLess)(this.cm6)}execCommand(t){if(t=="indentAuto")n.commands.indentAuto(this);else if(t=="goLineLeft")(0,g.cursorLineBoundaryBackward)(this.cm6);else if(t=="goLineRight"){(0,g.cursorLineBoundaryForward)(this.cm6);let e=this.cm6.state,r=e.selection.main.head;r<e.doc.length&&e.sliceDoc(r,r+1)!==`
`&&(0,g.cursorCharBackward)(this.cm6)}else console.log(t+" is not implemented")}setBookmark(t,e){var r=e!=null&&e.insertLeft?1:-1,i=this.indexFromPos(t),a=new ie(this,i,r);return a}addOverlay({query:t}){let e=new N.SearchQuery({regexp:!0,search:t.source,caseSensitive:!/i/.test(t.flags)});if(e.valid){e.forVim=!0,this.cm6Query=e;let r=N.setSearchQuery.of(e);return this.cm6.dispatch({effects:r}),e}}removeOverlay(t){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let e=N.setSearchQuery.of(this.cm6Query);this.cm6.dispatch({effects:e})}getSearchCursor(t,e){var r=this,i=null,a=null;e.ch==null&&(e.ch=Number.MAX_VALUE);var o=C(r.cm6.state.doc,e),s=t.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,function(u,m){return m||"\\"+u});function l(u,m=0,y=u.length){return new N.RegExpCursor(u,s,{ignoreCase:t.ignoreCase},m,y)}function f(u){var m=r.cm6.state.doc;if(u>m.length)return null;let y=l(m,u).next();return y.done?null:y.value}var h=1e4;function p(u,m){var y=r.cm6.state.doc;for(let O=1;;O++){let w=Math.max(u,m-O*h),$=l(y,w,m),H=null;for(;!$.next().done;)H=$.value;if(H&&(w==u||H.from>w+10))return H;if(w==u)return null}}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(u){var m=r.cm6.state.doc;if(u){let y=i?i.from==i.to?i.to-1:i.from:o;i=p(0,y)}else{let y=i?i.from==i.to?i.to+1:i.to:o;i=f(y)}return a=i&&{from:S(m,i.from),to:S(m,i.to),match:i.match},i&&i.match},from:function(){return a==null?void 0:a.from},to:function(){return a==null?void 0:a.to},replace:function(u){i&&(j(r,{changes:{from:i.from,to:i.to,insert:u}}),i.to=i.from+u.length,a&&(a.to=S(r.cm6.state.doc,i.to)))}}}findPosV(t,e,r,i){let{cm6:a}=this,o=a.state.doc,s=r=="page"?a.dom.clientHeight:0,l=C(o,t),f=v.EditorSelection.cursor(l,1,void 0,i),h=Math.round(Math.abs(e));for(let u=0;u<h;u++)r=="page"?f=a.moveVertically(f,e>0,s):r=="line"&&(f=a.moveVertically(f,e>0));let p=S(o,f.head);return(e<0&&f.head==0&&i!=0&&t.line==0&&t.ch!=0||e>0&&f.head==o.length&&p.ch!=i&&t.line==p.line)&&(p.hitSide=!0),p}charCoords(t,e){var r=this.cm6.contentDOM.getBoundingClientRect(),i=C(this.cm6.state.doc,t),a=this.cm6.coordsAtPos(i),o=-r.top;return{left:((a==null?void 0:a.left)||0)-r.left,top:((a==null?void 0:a.top)||0)+o,bottom:((a==null?void 0:a.bottom)||0)+o}}coordsChar(t,e){var r=this.cm6.contentDOM.getBoundingClientRect(),i=this.cm6.posAtCoords({x:t.left+r.left,y:t.top+r.top})||0;return S(this.cm6.state.doc,i)}getScrollInfo(){var t=this.cm6.scrollDOM;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight,width:t.scrollWidth,clientHeight:t.clientHeight,clientWidth:t.clientWidth}}scrollTo(t,e){t!=null&&(this.cm6.scrollDOM.scrollLeft=t),e!=null&&(this.cm6.scrollDOM.scrollTop=e)}scrollIntoView(t,e){if(t){var r=this.indexFromPos(t);this.cm6.dispatch({effects:_.EditorView.scrollIntoView(r)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(t,e){this.cm6.dom.style.width=t+4+"px",this.cm6.dom.style.height=e+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(t){this.$lineHandleChanges&&this.$lineHandleChanges.push(t);for(let r in this.marks)this.marks[r].update(t.changes);this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map(r=>r.map(t.changes)));var e=this.curOp=this.curOp||{};t.changes.iterChanges((r,i,a,o,s)=>{(e.$changeStart==null||e.$changeStart>a)&&(e.$changeStart=a),this.$lastChangeEndOffset=o;var l={text:s.toJSON()};e.lastChange?e.lastChange.next=e.lastChange=l:e.lastChange=e.change=l},!0),e.changeHandlers||(e.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var t=this.curOp=this.curOp||{};t.cursorActivityHandlers||(t.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(t,e){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var r=t()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return r}onBeforeEndOperation(){var t=this.curOp,e=!1;t&&(t.change&&ge(t.changeHandlers,this,t.change),t&&t.cursorActivity&&(ge(t.cursorActivityHandlers,this,null),t.isVimOp&&(e=!0)),this.curOp=null),e&&this.scrollIntoView()}moveH(t,e){if(e=="char"){var r=this.getCursor();this.setCursor(r.line,r.ch+t)}}setOption(t,e){switch(t){case"keyMap":this.state.keyMap=e;break;case"textwidth":this.state.textwidth=e;break}}getOption(t){switch(t){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readOnly":return this.cm6.state.readOnly;case"indentWithTabs":return this.cm6.state.facet(b.indentUnit)=="	";case"indentUnit":return this.cm6.state.facet(b.indentUnit).length||2;case"textwidth":return this.state.textwidth;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(t){this.state.overwrite=t}getTokenTypeAt(t){var e,r=this.indexFromPos(t),i=(0,b.ensureSyntaxTree)(this.cm6.state,r),a=i==null?void 0:i.resolve(r),o=((e=a==null?void 0:a.type)===null||e===void 0?void 0:e.name)||"";return/comment/i.test(o)?"comment":/string/i.test(o)?"string":""}overWriteSelection(t){var e=this.cm6.state.doc,r=this.cm6.state.selection,i=r.ranges.map(a=>{if(a.empty){var o=a.to<e.length?e.sliceString(a.from,a.to+1):"";if(o&&!/\n/.test(o))return v.EditorSelection.range(a.from,a.to+1)}return a});this.cm6.dispatch({selection:v.EditorSelection.create(i,r.mainIndex)}),this.replaceSelection(t)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(t){var e=this.cm6.state.selection;this.virtualSelection=v.EditorSelection.create(e.ranges,e.mainIndex);for(var r=0;r<this.virtualSelection.ranges.length;r++){var i=this.virtualSelection.ranges[r];i&&(this.cm6.dispatch({selection:v.EditorSelection.create([i])}),t(),this.virtualSelection.ranges[r]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}hardWrap(t){return ot(this,t)}};d.isMac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);d.Pos=M;d.StringStream=b.StringStream;d.commands={cursorCharLeft:function(n){(0,g.cursorCharLeft)(n.cm6)},redo:function(n){ve(n,!1)},undo:function(n){ve(n,!0)},newlineAndIndent:function(n){(0,g.insertNewlineAndIndent)({state:n.cm6.state,dispatch:t=>j(n,t)})},indentAuto:function(n){(0,g.indentSelection)(n.cm6)},newlineAndIndentContinueComment:void 0,save:void 0};d.isWordChar=function(n){return ne.test(n)};d.keys=Xe;d.addClass=function(n,t){};d.rmClass=function(n,t){};d.e_preventDefault=function(n){n.preventDefault()};d.e_stop=function(n){var t,e;(t=n==null?void 0:n.stopPropagation)===null||t===void 0||t.call(n),(e=n==null?void 0:n.preventDefault)===null||e===void 0||e.call(n)};d.lookupKey=function(t,e,r){var i=d.keys[t];i&&r(i)};d.on=ye;d.off=ke;d.signal=we;d.findMatchingTag=it;d.findEnclosingTag=at;d.keyName=void 0;function Ce(n,t,e){var r=document.createElement("div");return r.appendChild(t),r}function be(n,t){n.state.currentNotificationClose&&n.state.currentNotificationClose(),n.state.currentNotificationClose=t}function Ze(n,t,e){be(n,s);var r=Ce(n,t,e&&e.bottom),i=!1,a,o=e&&typeof e.duration!="undefined"?e.duration:5e3;function s(){i||(i=!0,clearTimeout(a),r.remove(),Se(n,r))}return r.onclick=function(l){l.preventDefault(),s()},xe(n,r),o&&(a=setTimeout(s,o)),s}function xe(n,t){var e=n.state.dialog;n.state.dialog=t,t&&e!==t&&(e&&e.contains(document.activeElement)&&n.focus(),e&&e.parentElement?e.parentElement.replaceChild(t,e):e&&e.remove(),d.signal(n,"dialog"))}function Se(n,t){n.state.dialog==t&&(n.state.dialog=null,d.signal(n,"dialog"))}function et(n,t,e,r){r||(r={}),be(n,void 0);var i=Ce(n,t,r.bottom),a=!1;xe(n,i);function o(l){if(typeof l=="string")s.value=l;else{if(a)return;a=!0,Se(n,i),n.state.dialog||n.focus(),r.onClose&&r.onClose(i)}}var s=i.getElementsByTagName("input")[0];return s&&(r.value&&(s.value=r.value,r.selectValueOnOpen!==!1&&s.select()),r.onInput&&d.on(s,"input",function(l){r.onInput(l,s.value,o)}),r.onKeyUp&&d.on(s,"keyup",function(l){r.onKeyUp(l,s.value,o)}),d.on(s,"keydown",function(l){r&&r.onKeyDown&&r.onKeyDown(l,s.value,o)||(l.keyCode==13&&e(s.value),(l.keyCode==27||r.closeOnEnter!==!1&&l.keyCode==13)&&(s.blur(),d.e_stop(l),o()))}),r.closeOnBlur!==!1&&d.on(s,"blur",function(){setTimeout(function(){document.activeElement!==s&&o()})}),s.focus()),o}var tt={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function rt(n){return n&&n.bracketRegex||/[(){}[\]]/}function nt(n,t,e,r,i){for(var a=i&&i.maxScanLineLength||1e4,o=i&&i.maxScanLines||1e3,s=[],l=rt(i),f=e>0?Math.min(t.line+o,n.lastLine()+1):Math.max(n.firstLine()-1,t.line-o),h=t.line;h!=f;h+=e){var p=n.getLine(h);if(p){var u=e>0?0:p.length-1,m=e>0?p.length:-1;if(!(p.length>a))for(h==t.line&&(u=t.ch-(e<0?1:0));u!=m;u+=e){var y=p.charAt(u);if(l.test(y)){var O=tt[y];if(O&&O.charAt(1)==">"==e>0)s.push(y);else if(s.length)s.pop();else return{pos:new M(h,u),ch:y}}}}}return h-e==(e>0?n.lastLine():n.firstLine())?!1:null}function it(n,t){}function at(n,t){var e,r,i=n.cm6.state,a=n.indexFromPos(t);if(a<i.doc.length){var o=i.sliceDoc(a,a+1);o=="<"&&a++}for(var s=(0,b.ensureSyntaxTree)(i,a),l=(s==null?void 0:s.resolve(a))||null;l;){if(((e=l.firstChild)===null||e===void 0?void 0:e.type.name)=="OpenTag"&&((r=l.lastChild)===null||r===void 0?void 0:r.type.name)=="CloseTag")return{open:me(i.doc,l.firstChild),close:me(i.doc,l.lastChild)};l=l.parent}}function me(n,t){return{from:S(n,t.from),to:S(n,t.to)}}var ie=class{constructor(t,e,r){this.cm=t,this.id=t.$mid++,this.offset=e,this.assoc=r,t.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return this.offset==null?null:this.cm.posFromIndex(this.offset)}update(t){this.offset!=null&&(this.offset=t.mapPos(this.offset,this.assoc,v.MapMode.TrackDel))}};function ot(n,t){for(var e,r=t.column||n.getOption("textwidth")||80,i=t.allowMerge!=!1,a=Math.min(t.from,t.to),o=Math.max(t.from,t.to);a<=o;){var s=n.getLine(a);if(s.length>r){var l=y(s,r,5);if(l){var f=(e=/^\s*/.exec(s))===null||e===void 0?void 0:e[0];n.replaceRange(`
`+f,new M(a,l.start),new M(a,l.end))}o++}else if(i&&/\S/.test(s)&&a!=o){var h=n.getLine(a+1);if(h&&/\S/.test(h)){var p=s.replace(/\s+$/,""),u=h.replace(/^\s+/,""),m=p+" "+u,l=y(m,r,5);l&&l.start>p.length||m.length<r?(n.replaceRange(" ",new M(a,p.length),new M(a+1,h.length-u.length)),a--,o--):p.length<s.length&&n.replaceRange("",new M(a,p.length),new M(a,s.length))}}a++}return a;function y(O,w,$){if(!(O.length<w)){var H=O.slice(0,w),We=O.slice(w),D=/^(?:(\s+)|(\S+)(\s+))/.exec(We),K=/(?:(\s+)|(\s+)(\S+))$/.exec(H),F=0,re=0;if(K&&!K[2]&&(F=w-K[1].length,re=w),D&&!D[2]&&(F||(F=w),re=w+D[1].length),F)return{start:F,end:re};if(K&&K[2]&&K.index>$)return{start:K.index,end:K.index+K[2].length};if(D&&D[2])return F=w+D[2].length,{start:F,end:F+D[3].length}}}}var wt=typeof navigator!="undefined"&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);function Me(n){return n.cm||null}function ae(n,t){let e=n.commands.findCommand(t);return e!=null?e:null}function Ee(n){return Object.values(n.commands.commands)}function st(n,t){let e=null;return n.iterateRootLeaves(r=>{r.view instanceof P.FileView&&r.view.file!==null&&r.view.file.path===t.path&&(e=r)}),e}function Le(n,t){let e=t.endsWith(".md"),r;if(t.contains("/")){t.startsWith("/")&&(t=t.slice(1));let a=t.split("/");t=a[a.length-1];let o=lt(n,a.slice(0,-1));if(!o)return null;r=o.children}else r=e?n.getMarkdownFiles():n.getFiles();t=t.toLowerCase();let i=null;for(let a of r)if(a instanceof P.TFile){if(a.name.toLowerCase()==t)return a;a.extension=="md"&&a.basename.toLowerCase()==t&&(i===null||a.path<i.path)&&(i=a)}return i}function lt(n,t){let e=n.getRoot(),r,i;if(!t)return e;typeof t=="string"?(t.startsWith("/")&&(t=t.slice(1)),i=t.split("/")):i=t;for(let a of i){r=!1;for(let o of e.children)if(o instanceof P.TFolder&&o.name.toLowerCase()==a.toLowerCase()){r=!0,e=o;break}if(!r)return null}return e}async function W(n,t,e={}){var a,o,s;let r=t instanceof P.TFile?t:n.vault.getFileByPath(t);if(!r)return;if(console.log(r),(a=e.useExisting)==null||a){let l=st(n.workspace,r);if(l){((o=e.active)==null||o)&&n.workspace.setActiveLeaf(l,{focus:!0});return}}await n.workspace.getLeaf(e.newLeaf).openFile(r,{active:(s=e.active)!=null?s:!0})}var q=class extends P.Modal{constructor(e,r={}){var s,l,f,h,p;super(e);this.invoked=!1;r.title&&this.setTitle(r.title),r.message&&this.setContent(r.message),this.default=(s=r.default)!=null?s:!0;let i=this.modalEl.createEl("div",{cls:"modal-button-container"});this.yesBtn=i.createEl("button",{text:(l=r.yesText)!=null?l:"Confirm"}),this.yesBtn.addEventListener("click",u=>this.resolve(!0));let a=(f=r.yesCls)!=null?f:"mod-cta";a&&this.yesBtn.addClass(a),this.noBtn=i.createEl("button",{text:(h=r.noText)!=null?h:"Cancel"}),this.noBtn.addEventListener("click",u=>this.resolve(!1));let o=(p=r.noCls)!=null?p:"mod-cancel";o&&this.noBtn.addClass(o)}open(){super.open(),(this.default?this.yesBtn:this.noBtn).focus()}resolve(e){this.callback&&!this.invoked&&(this.invoked=!0,this.callback(e)),this.close()}};function Te(n,t,e={}){let{modalEl:r}=n,i=createEl("div",{cls:"spacekeys-modal-title"});return r.insertBefore(i,r.firstChild),e.spacekeys?(i.createEl("strong",{text:"Spacekeys"}),t&&i.appendText(": "+t)):t&&(i.textContent=t),i}function Ae(n){var r,i;if(!n.editor.hasFocus())return!1;let t=n.editor.cm,e=Me(t);return(i=(r=e==null?void 0:e.state.vim)==null?void 0:r.insertMode)!=null?i:!0}var Pe=require("obsidian");var Q=class extends Error{};function U(n,t){if(!n)throw new Q(t)}function Ke(){throw new Q("Shouldn't happen.")}var A=class extends Error{constructor(t,{details:e,context:r}={}){super(t),this.details=e!=null?e:null,this.context=r!=null?r:null}};function Oe(n){return typeof n=="object"&&!Array.isArray(n)&&n!==null}function oe(n,t){let e={};for(let r in t){let i=t[r];if(r in n){let a=n[r];Oe(i)&&Oe(a)?e[r]=oe(a,i):e[r]=a}else e[r]=i}return e}function Re(n,t=/\s+/){if(t instanceof RegExp){let e=t.exec(n);return e?[n.substring(0,e.index),n.substring(e.index+e[0].length)]:[n,null]}else{let e=n.indexOf(t);return e<0?[n,null]:[n.substring(0,e),n.substring(e+t.length)]}}var Ie=`This is a sample keymap file for the [Spacekeys](http://github.com/jlumpe/obsidian-spacekeys) Obsidian plugin. The keymap itself is defined in a YAML code block below, it is wrapped in a Markdown file to allow editing within Obsidian. To use this file, enter its path in the Spacekeys plugin settings.

You can use the "Spacekeys: Find command ID" command to search for command IDs (either by assigning it a hotkey or invoking it through the command palette). See the plugin's description for more detailed instructions.


`;function se(n){return typeof n=="object"&&!Array.isArray(n)&&n!==null}var B=class extends Error{constructor(t,e={}){var r,i,a;super(t),this.path=(r=e.path)!=null?r:null,this.data=(i=e.data)!=null?i:null,this.cause=(a=e.cause)!=null?a:null}};function x(n,t,e,r){throw new B(n,{path:r?t.concat(r):t,data:e})}var ut={space:" ",spc:" ",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function ft(n){var a;let t={success:!1,error:"Invalid key code: "+JSON.stringify(n)};if(!n)return t;if(n=="-")return{success:!0,key:new R("-")};let e={},r,i=n.indexOf("-");if(i>=0){let o=n.substring(0,i);if(r=n.substring(i+1).toLowerCase(),!r||!o)return t;for(let s=0;s<o.length;s++){let l=o[s].toLowerCase();if(l=="c")e.ctrl=!0;else if(l=="s")e.shift=!0;else if(l=="a")e.alt=!0;else if(l=="m")e.meta=!0;else return{success:!1,error:"Invalid modifier code: "+o[s]}}}else r=n;return r.length>1&&(r=r.toLowerCase()),r=(a=ut[r])!=null?a:r,pe.test(r)?(V(r)&&(e.shift=!1),{success:!0,key:new R(r,e)}):t}var dt={" ":"spc",arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right"};function Be(n){var r;let t=(r=dt[n.key])!=null?r:n.key,e="";return n.ctrl&&(e+="c"),n.shift&&(e+="s"),n.alt&&(e+="a"),n.meta&&(e+="m"),e?e+"-"+t:t}function ht(n,t){se(n)||x("Root element not an object",[],n),"items"in n||x('Expected "items" property',[],n);let e=Fe(n,[],t);return U(e instanceof T),e}function Fe(n,t,e){let r;if(typeof n=="string"){n||x("Empty string not allowed",t,n);let[s,l]=Re(n.trim()," ");return new L(s,(l==null?void 0:l.trim())||null)}else se(n)||x("Expected string or object",t,n);let i="command"in n,a="file"in n,o="items"in n;return+i+ +a+ +o!=1&&x('Object must have exactly one of the following properties: "items", "command", or "file"',t,n),i?(typeof n.command!="string"&&x("Expected string",t,n.command,["command"]),n.command||x("Command ID cannot be empty",t,n.command,["command"]),r=new L(n.command)):a?(typeof n.file!="string"&&x("Expected string",t,n.command,["file"]),n.file||x("File name cannot be empty",t,n.command,["file"]),r=new I(n.file)):o?r=pt(n,t,e):Ke(),"description"in n&&(typeof n.description!="string"&&n.description!==null&&x("Expected string or null",t,n.description,["description"]),r.description=n.description||null),r}function pt(n,t,e){let r;!se(n.items)&&n.items!==null&&x("Expected group.items to be an object",t,n.item,["items"]),n.clear!==void 0&&typeof n.clear!="boolean"&&x("Expected group.clear to be a bool",t,n.clear,["clear"]),e&&n.clear!==!0?r=e.copy():r=new T;for(let i in n.items){let a=n.items[i],o=ft(i);o.success||x(o.error,t,n.items,["items"]);let s=o.key;if(a===null){r.removeChild(s);continue}let l=r.getChild(s),f=l instanceof T?l:void 0,h=Fe(a,t.concat(["items",i]),f);r.setChild(s,h)}return r}function z(n,t){let e;try{e=(0,Pe.parseYaml)(n)}catch(r){throw new B(String(r),{cause:r})}return ht(e,t)}function De(n,t){let e=gt(n);if(!e)throw new B("No code block found");return z(e,t)}function gt(n){let t=n.matchAll(/^```.*$/mg),e=null;for(let r of t)if(U(r.index),e===null)e=r.index+r[0].length;else return n.substring(e,r.index);return null}function G(n,t){return t&&t!="auto"?t:/\.ya?ml$/.test(n)?"yaml":/\.md$/.test(n)?"markdown":null}function Ne(n){let t=Ie;return t+="```yaml\n",t+=n,t+="\n```\n",t}function _e(n){return n.map(t=>t.repr()).join(" ")}var le={delay:500,execDelay:100,showInvalid:!0,backspaceReverts:!0,backspaceCloses:!0,trimDescriptions:!0,dimBackground:!0},J=class extends k.Modal{constructor(e){super(e.app);this.timeoutHandle=null;this.plugin=e,this.commands=e.keymap,this.settings=Object.assign({},le,e.settings.modal),this.containerEl.addClass("spacekeys-modal-container"),this.modalEl.addClass("spacekeys-modal"),this.modalEl.empty(),this.suggestionsEl=this.modalEl.createEl("div",{cls:"spacekeys-suggestions"}),this.statusEl=this.modalEl.createEl("div",{cls:"spacekeys-modal-status"}),this.isOpen=!1,this.setCollapsed(!0),this.dimBackground=this.settings.dimBackground,this.keySequence=[],this.scope.register(null,null,this.handleKey.bind(this))}onOpen(){super.onOpen(),this.isOpen=!0,this.settings.delay<=0?this.setCollapsed(!1):this.setExpandTimer(),this.update()}onClose(){super.onClose(),this.isOpen=!1,this.clearExpandTimer(),this.setCollapsed(!0)}setExpandTimer(){this.clearExpandTimer(),this.isOpen&&this.isCollapsed&&(this.timeoutHandle=window.setTimeout(()=>this.delayedExpand(),this.settings.delay))}clearExpandTimer(){this.timeoutHandle!==null&&window.clearTimeout(this.timeoutHandle),this.timeoutHandle=null}delayedExpand(){this.timeoutHandle=null,this.isOpen&&this.setCollapsed(!1)}setCollapsed(e){e=e&&this.settings.delay>0,this.isCollapsed=e,this.containerEl.toggleClass("spacekeys-modal-collapsed",e)}handleKey(e,r){if(this.settings.delay>0&&this.setExpandTimer(),this.settings.backspaceReverts&&r.key=="Backspace"){this.settings.backspaceCloses&&this.keySequence.length==0?this.close():(this.keySequence.pop(),this.update());return}this.keySequence.push(R.fromEvent(e)),this.update(),e.preventDefault()}update(){let e=this.commands.find(this.keySequence);if(e instanceof L){this.execCommand(e.command_id),this.close();return}if(e instanceof I){this.openFile(e.file_path),this.close();return}if(e===null){this.invalidKeys(),this.close();return}let r=this.keySequence.length==0;this.statusEl.toggleClass("spacekeys-modal-status-empty",r),this.statusEl.empty(),this.keySequence.length==0?this.statusEl.appendText("<waiting on input>"):this.statusEl.appendText(_e(this.keySequence)),this.suggestionsEl.empty();let i=this.getSuggestions(e);for(let a of i){let o=this.suggestionsEl.createEl("div");this.renderSuggestion(a,o)}}getSuggestions(e){let r=[];for(let i of e.children){let a={key:i.key,item:i.item,command:i.item instanceof L?ae(this.app,i.item.command_id):null};(this.settings.showInvalid||!(i.item instanceof L&&a.command===null))&&r.push(a)}return r.sort(this.compareSuggestions.bind(this)),r}compareSuggestions(e,r){let i=e.item instanceof T,a=r.item instanceof T,o=e.item instanceof I,s=r.item instanceof I;return i&&!a?-1:a&&!i?1:o&&!s?-1:s&&!o?1:R.compare(e.key,r.key)}renderKey(e,r){let i=e.repr(!0);r.addClass("spacekeys-suggestion-key"),r.createEl("kbd",{text:i})}renderSuggestion(e,r){r.addClass("spacekeys-suggestion");let i=e.item.description;e.item instanceof L?(r.addClass("spacekeys-command"),e.command?(e.command.id==="spacekeys:repeat-last"&&(this.plugin.lastCommand?i!=null||(i="Repeat: "+this.getCommandDescription(this.plugin.lastCommand.name)):r.addClass("spacekeys-invalid")),i!=null||(i=this.getCommandDescription(e.command.name))):(r.addClass("spacekeys-invalid"),i!=null||(i=e.item.command_id))):e.item instanceof I?(r.addClass("spacekeys-file"),i!=null||(i=`Open: ${e.item.file_path}`)):r.addClass("spacekeys-group");let a=r.createEl("div");this.renderKey(e.key,a),r.createEl("div",{cls:"spacekeys-suggestion-label",text:i!=null?i:"?"}),r.setAttr("title",i)}getCommandDescription(e){var r,i;return this.settings.trimDescriptions&&(i=(r=/^.+:\s*(.*)/.exec(e))==null?void 0:r[1])!=null?i:e}execCommand(e){let r=ae(this.app,e);if(r)window.setTimeout(()=>this.app.commands.executeCommand(r),this.settings.execDelay),r.id!=="spacekeys:repeat-last"&&(this.plugin.lastCommand=r);else{let i=JSON.stringify(e),a=document.createDocumentFragment();a.appendText("Unknown command: "),a.createEl("code",{text:i}),new k.Notice(a),console.error("Invalid command ID: "+i)}}invalidKeys(){let e=_e(this.keySequence),r=document.createDocumentFragment();r.appendText("Invalid key sequence: "),r.createEl("code",{text:e}),new k.Notice(r)}openFile(e){let r=Le(this.app.vault,e);r?W(this.app,r,{newLeaf:"tab"}):new k.Notice(`File not found: ${e}`)}},X=class extends k.FuzzySuggestModal{constructor(t){super(t.app),this.assignedCommands=t.keymap.assignedCommands(),this.initContents(),this.scope.register(["Ctrl"],"Enter",(e,r)=>{this.chooser.useSelectedItem(e)})}initContents(){this.modalEl.addClass("spacekeys-find-command-modal"),Te(this,"find command",{spacekeys:!0}),this.setInstructions([{command:"\u21B5",purpose:"Copy ID"},{command:"Ctrl + \u21B5",purpose:"Insert ID"}])}getItems(){return Ee(this.app)}getItemText(t){return t.name+" "+t.id}renderSuggestion(t,e){e.addClass("mod-complex");let i=e.createEl("div",{cls:"suggestion-content"}).createEl("span",{cls:"suggestion-title"}),a=e.createEl("div",{cls:"suggestion-aux"});if(super.renderSuggestion(t,i),t.item.id in this.assignedCommands){e.addClass("spacekeys-is-assigned");let o=this.assignedCommands[t.item.id];for(let s=0;s<o.length;s++){s>0&&a.appendText(", ");let l=a.createEl("kbd",{cls:"spacekeys-key-sequence"});for(let f=0;f<o[s].length;f++)f>0&&l.appendText(" "),l.appendText(o[s][f].repr(!0))}}}onChooseItem(t,e){e.ctrlKey?this.insertCommand(t):this.copyCommand(t)}copyCommand(t){navigator.clipboard.writeText(t.id),new k.Notice("Copied to clipboard: "+t.id)}insertCommand(t){let e=this.app.workspace.getActiveViewOfType(k.MarkdownView);e?e.editor.replaceSelection(t.id):new k.Notice("No active editor")}},Z=class extends k.Modal{constructor(e){super(e);this.keycodes="";this.initContents(),this.scope.register(null,null,this.handleKey.bind(this))}initContents(){this.setTitle("Spacekeys key code finder"),this.contentEl.createEl("p",{text:`
		Enter one or more keypresses to get their key codes.
		Press Esc to close the modal and copy the key codes to the clipboard.
		`}),this.text=this.contentEl.createEl("input",{type:"text"}),this.text.addClass("spacekeys-key-code-generator"),this.text.readOnly=!0}handleKey(e,r){let i=R.fromEvent(e),a=Be(i);this.keycodes&&(this.keycodes+=" "),this.keycodes+=a,this.text.value=this.keycodes,e.preventDefault()}onClose(){super.onClose(),this.keycodes&&(navigator.clipboard.writeText(this.keycodes),new k.Notice("Key code(s) copied to clipboard"))}};var He=`items:
  SPC: command-palette:open
  TAB: editor:focus
  /: global-search:open
  ",": editor:context-menu
  "?": switcher:open
  P: app:go-back
  N: app:go-forward
  .: spacekeys:repeat-last

  w:
    description: Workspace
    items:
      TAB: editor:focus
      d: workspace:close
      f: file-explorer:open
      h: editor:focus-left
      l: editor:focus-right
      k: editor:focus-top
      j: editor:focus-bottom
      n: workspace:next-tab
      N: workspace:new-tab
      o: outline:open
      p: workspace:previous-tab
      P: workspace:toggle-pin
      s: workspace:split-horizontal
      S: workspace:toggle-stacked-tabs
      t: tag-pane:open
      u: workspace:undo-close-pane
      v: workspace:split-vertical
      L: app:toggle-left-sidebar
      r: app:toggle-right-sidebar
      R: app:toggle-ribbon
      w: workspace:open-in-new-window
      W: workspace:move-to-new-window

      x:
        description: Close
        items:
          g: workspace:close-tab-group
          G: workspace:close-others-tab-group
          t: workspace:close
          T: workspace:close-others
          w: workspace:close-window

       # workspace:goto-tab-1
       # workspace:goto-tab-2
       # workspace:goto-tab-3
       # workspace:goto-tab-4
       # workspace:goto-tab-5
       # workspace:goto-tab-6
       # workspace:goto-tab-7
       # workspace:goto-tab-8
       # workspace:goto-last-tab

       # workspace:show-trash

  f:
    description: File
    items:
      a: markdown:add-alias
      c: workspace:copy-path
      C: workspace:copy-url
      d: app:delete-file
      m: file-explorer:move-file
      o: open-with-default-app:open
      O: open-with-default-app:show
      r: editor:open-search-replace
      R: workspace:edit-file-title
      s: editor:save-file
      t: file-explorer:reveal-active-file
      T: tag-pane:open
      u: outline:open-for-current
      /: editor:open-search

      n:
        description: New
        items:
          c: file-explorer:duplicate-file
          n: file-explorer:new-file
          N: file-explorer:new-file-in-current-tab
          r: file-explorer:new-file-in-new-pane


      p:
        description: Properties
        items:
          a: markdown:add-metadata-property
          e: markdown:edit-metadata-property
          c: markdown:clear-metadata-properties

  x:
    description: Text
    items:
      b: editor:toggle-bold
      c: editor:toggle-code
      C: editor:toggle-comments
      d: editor:delete-paragraph
      F: editor:clear-formatting
      i: editor:toggle-italics
      p: editor:insert-codeblock
      q: editor:toggle-blockquote
      s: editor:toggle-strikethrough
      l: editor:toggle-bullet-list
      H: editor:toggle-highlight
      M: editor:toggle-inline-math

      # editor:set-heading
      # editor:set-heading-0
      # editor:set-heading-1
      # editor:set-heading-2
      # editor:set-heading-3
      # editor:set-heading-4
      # editor:set-heading-5
      # editor:set-heading-6
      # editor:rename-heading

      # editor:swap-line-down
      # editor:swap-line-up

      # editor:toggle-bullet-list
      # editor:toggle-checklist-status
      # editor:toggle-numbered-list
      # editor:cycle-list-checklist

  i:
    description: Insert
    items:
      a: editor:attach-file
      c: editor:insert-codeblock
      C: editor:insert-callout
      e: editor:insert-embed
      l: editor:insert-link
      L: editor:insert-wikilink
      m: editor:insert-mathblock
      r: editor:insert-horizontal-rule
      T: editor:insert-tag

      t:
        description: Template
        items:
          t: insert-template
          d: insert-current-date
          T: insert-current-time

  t:
    description: Table
    items:
      h: editor:table-col-left
      l: editor:table-col-right
      k: editor:table-row-up
      j: editor:table-row-down
      c: editor:table-col-after
      C: editor:table-col-before
      r: editor:table-row-after
      R: editor:table-row-before
      v: editor:table-row-copy
      V: editor:table-col-copy
      i: editor:insert-table

      d:
        description: Delete
        items:
          c: editor:table-col-delete
          r: editor:table-row-delete

      a:
        description: Align
        items:
          c: editor:table-col-align-center
          l: editor:table-col-align-left
          r: editor:table-col-align-right

  v:
    description: View
    items:
      p: editor:toggle-source
      r: markdown:toggle-preview
      s: editor:toggle-spellcheck
      T: window:toggle-always-on-top

      # window:reset-zoom
      # window:zoom-in
      # window:zoom-out

  # "Workspaces" core plugin
  l:
    description: Layout
    items:
      l: workspaces:save-and-load
      L: workspaces:load
      o: workspaces:open-modal
      s: workspaces:save

# editor:toggle-fold-properties
# editor:toggle-fold
# editor:unfold-all
# editor:fold-all
# editor:fold-less
# editor:fold-more

# editor:follow-link
# editor:open-link-in-new-leaf
# editor:open-link-in-new-split
# editor:open-link-in-new-window

`;var ee={default:He};function E(...n){}var Ve={keymapFile:{path:null,format:"auto",extend:!1,autoReload:!1},modal:le,activateOnSpace:"disabled"};function ce(n){if(!(n in ee))return console.error("No builtin keymap named "+n),null;let t=ee[n];try{return z(t)}catch(e){console.error("Error parsing default keymap "+n),e instanceof B?console.error(e.message,e.path,e.data):console.error(e)}return null}var te=class extends c.Plugin{constructor(){super(...arguments);this.lastCommand=null;this.spaceHandler=null;this.fileWatcher=null;this.debouncedReloadKeymap=(0,c.debounce)(()=>this.tryLoadKeymap(),500,!0)}async onload(){var e;console.log("Loading plugin: Spacekeys"),E("development build"),this.registerCommands(),this.keymap=(e=ce("default"))!=null?e:new T,await this.loadSettings(),this.addSettingTab(new ue(this.app,this)),this.updateSpaceHandler(),this.app.workspace.onLayoutReady(()=>{this.settings.keymapFile.path&&(this.tryLoadKeymap({notifySuccess:!1}),this.updateFileWatcher())})}onunload(){this.updateSpaceHandler(!1),this.updateFileWatcher(!1)}registerCommands(){this.addCommand({id:"leader",name:"Leader",callback:()=>this.activateLeader()}),this.addCommand({id:"load-keymap",name:"Reload keymap",callback:()=>this.tryLoadKeymap({onError:"modal"})}),this.addCommand({id:"find-command",name:"Find command ID",callback:()=>{new X(this).open()}}),this.addCommand({id:"get-keycode",name:"Get key code",callback:()=>{new Z(this.app).open()}}),this.addCommand({id:"repeat-last",name:"Repeat last command",callback:()=>this.repeatLastCommand()})}async loadSettings(){let e=await this.loadData();if(e===null){this.settings=Ve;return}this.settings=oe(e,Ve)}async saveSettings(){this.settings.pluginVersion=this.manifest.version,await this.saveData(this.settings),this.updateFileWatcher()}activateLeader(){new J(this).open()}repeatLastCommand(){this.lastCommand?this.lastCommand.id==="spacekeys:repeat-last"?console.warn("Last command was repeat-last!"):this.app.commands.executeCommand(this.lastCommand):new c.Notice("No last command to repeat")}isActivateOnSpaceEnabled(){let e=this.settings.activateOnSpace;return e=="enabled"||e=="markdown_only"}updateSpaceHandler(e=null){e=e!=null?e:this.isActivateOnSpaceEnabled();let r=this.app.keymap.getRootScope();e?this.spaceHandler===null&&(E("Registering space event handler"),this.spaceHandler=r.register([]," ",this.handleSpace.bind(this))):this.spaceHandler!==null&&(E("Unregistering space event handler"),r.unregister(this.spaceHandler),this.spaceHandler=null)}handleSpace(e,r){if(!this.isActivateOnSpaceEnabled())return!0;E("handleSpace()");let i=this.shouldRejectSpace();return i?(E("Activate on space rejected: "+i),!0):(this.activateLeader(),!1)}shouldRejectSpace(){var i,a;let e=this.app.workspace.getActiveViewOfType(c.MarkdownView),r=(i=this.app.workspace.activeLeaf)==null?void 0:i.view.getViewType();if(e&&e.editor.hasFocus()){if(E("Editor focused"),Ae(e))return"Editor in insert mode"}else{if(E("Editor not focused"),!e&&this.settings.activateOnSpace=="markdown_only")return"Not in markdown editor";if(r==="webviewer")return"In webviewer";if(r==="canvas")return"In canvas";let o=(a=document.activeElement)==null?void 0:a.tagName;if(o=="INPUT"||o=="TEXTAREA")return"input/textarea element focused";if(document.activeElement instanceof HTMLElement&&document.activeElement.contentEditable=="true")return"Active element has contenteditable"}return null}async loadKeymap(){let e=this.settings.keymapFile.path,r;if(!e)throw new A("Keymap file not set in plugin settings");let i=this.app.vault.getFileByPath(e);if(i===null)throw new A("File not found");let a=G(e,this.settings.keymapFile.format);if(a==null)throw new A("Could not guess format of file from extension");E("loading keymap from "+e);try{r=await this.app.vault.cachedRead(i)}catch(s){throw console.error(s),new A("Unable to read file",{context:s})}let o=this.settings.keymapFile.extend&&ce("default")||void 0;try{a==="markdown"?this.keymap=De(r,o):this.keymap=z(r,o)}catch(s){let l=s instanceof B?s.message:null;throw new A("Parse error",{details:l,context:s})}}async tryLoadKeymap({allowDefault:e=!1,notifySuccess:r=!0,onError:i="notice"}={}){if(!this.settings.keymapFile.path&&e){let a=ce("default");return U(a),this.keymap=a,{loaded:!1,error:null}}try{await this.loadKeymap()}catch(a){if(!(a instanceof A))throw a;let o=`Spacekeys: failed to load keymap (${a.message})`;return console.error(o),a.context&&console.error(a.context),i==="notice"?new c.Notice(o,5e3):i==="modal"&&this.showLoadErrorModal(a),{loaded:!1,error:a}}return r&&new c.Notice("Spacekeys: keymap reloaded"),{loaded:!0,error:null}}showLoadErrorModal(e){var o;let r=new c.Modal(this.app);r.setTitle("Spacekeys: Error loading keymap"),r.modalEl.addClass("spacekeys-keymap-error");let i=r.contentEl.createEl("dl");function a(s,l){return i.createEl("dt",{text:s+":"}),i.createEl("dd",{text:l!=null?l:""})}if(a("Error",e.message),a("File").createEl("code",{text:(o=this.settings.keymapFile.path)!=null?o:"<unset>"}),e.context instanceof B){let{path:s,cause:l}=e.context,f=a("Details");if(l?f.createEl("pre",{text:l.message}):f.setText(e.context.message),s!==null){let h=a("YAML path");s?h.createEl("code",{text:s.join(".")}):h.setText("Root element")}}else e.details&&a("Details",e.details);new c.Setting(r.contentEl).addButton(s=>s.setButtonText("OK").setCta().onClick(l=>r.close())),r.open()}updateFileWatcher(e){e!=null||(e=this.settings.keymapFile.path&&this.settings.keymapFile.autoReload||!1),e&&!this.fileWatcher&&(E("Registering keymap file watcher"),this.fileWatcher=this.app.vault.on("modify",r=>{r.path===this.settings.keymapFile.path&&(E("Keymap file modified, reloading"),this.debouncedReloadKeymap())})),!e&&this.fileWatcher&&(E("Unregistering keymap file watcher"),this.app.vault.offref(this.fileWatcher),this.fileWatcher=null)}},ue=class extends c.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName("Spacekeys keymap file").setDesc("YAML or Markdown file defining a custom keymap (see plugin description).").setHeading().addButton(e=>e.setIcon("refresh-cw").setTooltip("(Re)load keymap from file").onClick(r=>this.plugin.tryLoadKeymap({onError:"modal"})).setClass("mod-cta")).addButton(e=>e.setIcon("file-plus-2").setTooltip("Create file with default contents").onClick(r=>this.createFile())).addButton(e=>e.setIcon("pencil").setTooltip("Open file for editing").onClick(r=>this.openFile())).addButton(e=>e.setIcon("external-link").setTooltip("Show file in system explorer").onClick(r=>this.showFile())),new c.Setting(t).setName("Path").setDesc("Path to file within your vault, including extension (.md, .yml).").addText(e=>{var r;return e.setPlaceholder("spacekeys.md").setValue((r=this.plugin.settings.keymapFile.path)!=null?r:"").onChange(async i=>{i=i.trim(),this.plugin.settings.keymapFile.path=i?(0,c.normalizePath)(i):null,await this.plugin.saveSettings()})}),new c.Setting(t).setName("Format").setDesc('Force parsing as specified format, or leave on "Auto" to determine based on file extension.').addDropdown(e=>e.addOptions({auto:"Auto",markdown:"Markdown",yaml:"YAML"}).setValue(this.plugin.settings.keymapFile.format).onChange(async r=>{this.plugin.settings.keymapFile.format=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Extend default").setDesc("File extends the default keymap instead of defining a new one.").addToggle(e=>e.setValue(this.plugin.settings.keymapFile.extend).onChange(async r=>{this.plugin.settings.keymapFile.extend=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Auto reload").setDesc("Automatically reload keymap when file changed.").addToggle(e=>e.setValue(this.plugin.settings.keymapFile.autoReload).onChange(async r=>{this.plugin.settings.keymapFile.autoReload=r,await this.plugin.saveSettings()})),new c.Setting(t).setHeading().setName("Behavior"),new c.Setting(t).setName("Delay").setDesc("Delay before expanding suggestions modal (milliseconds).").addText(e=>e.setValue(""+this.plugin.settings.modal.delay).onChange(async r=>{let i=parseInt(r);this.plugin.settings.modal.delay=i>0?i:0,await this.plugin.saveSettings()})),new c.Setting(t).setName("Backspace undoes last keypress").setDesc("Pressing backspace while the leader modal is open undoes the last keypress. You can disable this to assign commands to the backspace key.").addToggle(e=>e.setValue(this.plugin.settings.modal.backspaceReverts).onChange(async r=>{this.plugin.settings.modal.backspaceReverts=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Backspace closes on empty").setDesc("Attempting to undo the last keypress when there is no input closes the leader modal.").addToggle(e=>e.setValue(this.plugin.settings.modal.backspaceCloses).onChange(async r=>{this.plugin.settings.modal.backspaceCloses=r,await this.plugin.saveSettings()})),new c.Setting(t).setHeading().setName("Appearance"),new c.Setting(t).setName("Dim background").setDesc("Dim the rest of the window when displaying key suggestions.").addToggle(e=>e.setValue(this.plugin.settings.modal.dimBackground).onChange(async r=>{this.plugin.settings.modal.dimBackground=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Shorten command labels").setDesc("Hide the part of the command description before the colon (if any). This is typically redundant. Does not apply to command descriptions set explicitly in the keymap file.").addToggle(e=>e.setValue(this.plugin.settings.modal.trimDescriptions).onChange(async r=>{this.plugin.settings.modal.trimDescriptions=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Show invalid commands").setDesc("Show key sequences with invalid command IDs. This can help with debugging your key map file.").addToggle(e=>e.setValue(this.plugin.settings.modal.showInvalid).onChange(async r=>{this.plugin.settings.modal.showInvalid=r,await this.plugin.saveSettings()})),new c.Setting(t).setHeading().setName("Experimental").setDesc("Features in this section may not work correctly."),new c.Setting(t).setName("Activate on space").setDesc("Activate when pressing spacebar (when not inserting text).").addDropdown(e=>e.addOptions({disabled:"Disabled",enabled:"Enabled",markdown_only:"Markdown only"}).setValue(this.plugin.settings.activateOnSpace).onChange(async r=>{this.plugin.settings.activateOnSpace=r,await this.plugin.saveSettings(),this.plugin.updateSpaceHandler()}))}async createFile(){let t=this.plugin.settings.keymapFile.path;if(!t)return;let e=G(t,this.plugin.settings.keymapFile.format);if(e==null)throw new A("Could not guess format of file from extension");let r=ee.default,i=e==="markdown"?Ne(r):r,a=this.app.vault.getFileByPath(t);if(a){let o=new q(this.app,{title:"Keymap file exists",message:`The file "${t}" exists, overwrite?`,yesText:"Overwrite",yesCls:"mod-warning",default:!1});o.callback=async s=>{s&&(await this.app.vault.modify(a,i),W(this.app,a,{newLeaf:"tab"}))},o.open()}else{let o=await this.app.vault.create(t,i);W(this.app,o,{newLeaf:"tab"})}}openFile(){let t=this.plugin.settings.keymapFile.path;if(!t)return;let e=this.app.vault.getAbstractFileByPath(t);if(!(e instanceof c.TFile)){new c.Notice("Not a file: "+t);return}let r=G(t,this.plugin.settings.keymapFile.format);W(this.app,e,{newLeaf:r=="markdown"?"tab":!1})}showFile(){let t=this.plugin.settings.keymapFile.path;t&&this.app.showInFolder(t)}};

/* nosourcemap */